<!DOCTYPE html>
<html lang="en">

  <head>
    
    <!-- Meta Tag -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- SEO -->
    <meta name="description" content="Personal blog about data, quality and managment by Michael Korotkov - data analyst, coding enthusiast and quality aficionado">
    <meta name="author" content="Michael Korotkov">
    <meta name="url" content="https://mikorotkov.github.io/data-extraction-from-excel-with-openpyxl.html">
    <meta name="copyright" content="Michael Korotkov">
    <meta name="robots" content="noindex,nofollow">
    <link rel="canonical" href="https://mikorotkov.github.io/data-extraction-from-excel-with-openpyxl.html" />
    
    
    <title>How to extract data from multiple excel files into csv with Python?</title>
    
    <!-- Favicon -->
    <link rel="shortcut icon" href="/images/favicon/data.ico">
    <link rel="apple-touch-icon" sizes="144x144" type="image/x-icon" href="/images/favicon/data.ico">
    
    <!-- All CSS Plugins -->
    <link rel="stylesheet" type="text/css" href="/css/plugin.css">
    
    <!-- Main CSS Stylesheet -->
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    
    <!-- Google Web Fonts  -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:400,300,500,600,700">

 <!-- Syntax Highlighter  -->
 <link rel="stylesheet" type="text/css" href="/css/syntax/shCore.css">
<link rel="stylesheet" type="text/css" href="/css/syntax/shThemeDefault.css">
    
    
    <!-- HTML5 shiv and Respond.js support IE8 or Older for HTML5 elements and media queries -->
    <!--[if lt IE 9]>
	   <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	   <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    

  </head>

 <body>

	
     
	 <!-- Preloader Start -->
     <div class="preloader">
	   <div class="rounder"></div>
      </div>
      <!-- Preloader End -->
      
      
    
    
    <div id="main">
        <div class="container">
            <div class="row">
            	
               
                 
                 <!-- About Me (Left Sidebar) Start -->
                 <div class="col-md-3">
                  <div class="about-fixed">
                   
                    <div class="my-pic">
                       <img src="/images/pic/my-pic.jpg" alt="">
                       <a href="javascript:void(0)" class="collapsed" data-target="#menu" data-toggle="collapse"><i class="icon-menu menu"></i></a>
                        <div id="menu" class="collapse">
                          <ul class="menu-link">
                              <li><a href="/">Home</a></li>
                              <li><a href="/contact.html">Contact</a></li>
                              <li><a href="/about.html">About</a></li>
                           </ul>
                        </div>
                       </div>
                     
                     
                     
                     <div class="my-detail">
                     
                       <div class="white-spacing">
                           <h1>Michael Korotkov</h1>
                           <span>Data analyst <br> Coding enthusiast <br> Quality aficionado</span>
                       </div> 
                      
                      <ul class="social-icon">
                       <li><a href="https://www.linkedin.com/in/michaelkorotkov/" target="_blank" class="linkedin"><i class="fa fa-linkedin"></i></a></li>
                       <li><a href="https://github.com/mikorotkov" target="_blank" class="github"><i class="fa fa-github"></i></a></li>
                       </ul>

                   </div>
                 </div>
               </div>
               <!-- About Me (Left Sidebar) End -->
                
                
                
                
                 
                                  <!-- Blog Post (Right Sidebar) Start -->
                                  <div class="col-md-9">
                                    <div class="col-md-12 page-body">
                                      <div class="row">
                                        <!--Header-->
                                        <div class="header" id="myHeader">
                
                                            <div class="row">
                                                <a href="/" class="col-sm-1">Home</a>
                                                <a href="/about.html"class="col-sm-1">About</a>
                                                <a href="/contact.html"class="col-sm-1">Contact</a>
                                              </div>
                                              </div>
                                              <!--End Header-->
                                            
                                            <div class="sub-title">
                                               <h2>Recent posts</h2>
                                               
                
                                            
                                            
                                            <div class="col-md-12 content-page">
                              <div class="col-md-12 blog-post">
                            	
                                
                                <!-- Post Headline Start -->
                                <div class="post-title">
                                    <h1>How to extract data from multiple excel files into csv with Python?</h1> 
                                   </div>
                                   <!-- Post Headline End -->
                                    
                                    
                                <!-- Post Detail Start -->
                                <div class="post-info">
                                    <span>August 15,2018 / by <a href="/about.html" target="_blank">Michael Korotkov</a></span>
                                   </div>
                                   <!-- Post Detail End -->
                                    
                                    
                                    <p>In the everyday office life we often find ourselves using Excel sheets as data entrence medium. Which is a great use of Excel, because it's familiar and flexible enough to do rather complex manipulations with the data right away. The problem is that convinient interface for data entry that you create in the workbook, often is not the best format for the machine to read your data. You can ofcourse store the data in your Excel workbook, but very soon you will notice that it becomes very slow and crashes more an more often, because Excel is not build to store the data. </p>
                                    <br>
                                    <p>So often you find yourself needing to extract some sort of data from excel sheet and into the csv to use it as an input for the database, analysis or visualizytion tool etc. It also helps to get read of that formulas which makes workbooks very slow. Technically speaking this is the first step in what is called ETL - Extract, Transform and Load.</p>
                                    <br>
                                    <p>There's a great library for python called openpyxl, that can be used for this exact purpose. However as a non-technical guy I found myself struggling to find examples of code that as a little more complicated stuff than examples in the documentation. A great resource for this is this <a href="http://automatetheboringstuff.com/">book</a>, but some of the parts of the code that is used in the examples is deprecated, so it's not a copy-paste solution. </p>
                                    <br>
                                    <p>The following code is. At least for the time being. So feel free to re-use it and improve it. You can find the github link at the end. I tried my best to separate the code into modules and explain each and every one of them in the human language, so that you can use it and adjust it without the need for a deep technical understaning, although you will probably need to google some stuff if you are a complete beginner. So lets start.</p>
                                    <br>
                                    <p>You can find the link to github <a href="">repo</a> for the full version of the code. I tried my best to separate the code into modules and explain each of them, so that you can use it and adjust it.</p>
                                    
                                    <div class="post-title">
                                      <h2>Setup and naming convention</h2> 
                                     </div>
                                     
                                     
                                     <p>The purpose of the script is to open number of workbooks (which follow a certain naming convention and internal structure for each sheet) extract data from particular sheets and particular columns. </p>
                                  <p>The naming convention for the files I go through to extract the data and this convention plays an import role in the script. File name consists of the word <em>"source_file_"</em> + country name. Here's an example:</p>
                                     <li>
                                       <ul>source_file_Austria</ul>
                                       <ul>source_file_Germany</ul>
                                     </li>

                                     <p>Apart from data sheets workbook contains summary sheet, example sheet and a sheet with pivot table. I exclude this 3 sheets, because they don’t contain the data I need. Each data sheet has a following structure:</p>
                                  
                                  <!-- Post Image Gallery Start -->
                                  <div class="row margin-top-40 margin-bottom-40">
                                 
                                    <div class="col-md-12 col-sm-12 col-xs-12">
                                      <a href="/images/blog/example_of_excel_file.jpg" class="image-popup" title="Example of excel file to extract data from">
                                      <img src="/images/blog/example_of_excel_file.jpg" class="img-responsive" alt="Example of excel file to extract data from">
                                     </a>
                                    </div>

                                 </div>
                                 <!-- Post Image Gallery End -->
                                 <div class="post-title">
                                    <h2>Step 1 - preparing to read from input files and into output csv</h2> 
                                   </div>

                                 <p>First of all I define all the variables I will be using:
                                    <li>
                                        <ul>Current date and time and second line format it to show in the format: Year-month-day</ul>
                                        <ul>A path to the folder where your excel sheets are stored and where the output file will be stored as well</ul>
                                        <ul>I give the first part of the file name, based on the naming convention</ul>
                                        <ul>Define a dictionary, because for my purpose I will also need id that is associated with each country (the number. E.g. id of Austria is 9, id of Germany is 1, etc. Of course it can also be replaced with the dictionary (which will also require changing all related to country id later in the script)</ul>
                                      </li>
                                  </p>
                                  
                                     <!-- Post Coding (SyntaxHighlighter) Start -->
                                  <div class="margin-top-40 margin-bottom-40">  
                                   <pre class="brush: python">
                                      import openpyxl
                                      import csv
                                      import datetime
                                      from babel.numbers import format_decimal
                                      now=datetime.datetime.now()
                                      cur_date=now.strftime("%Y%m%d")
                                      
                                      #dictionary for iterating between files 
                                      countries={9:"Austria", 6:"France", 1:"Germany", 11:"Italy"}
                                      path='C:\\Michael\\Documents\\'
                                      input_file='source_file_'
                                  </pre>
                                 </div>
                                 <!-- Post Coding (SyntaxHighlighter) End -->
                                 
                                  <p>Next output file with predefined columns created/emptied if exists. Output file will be created in the same folder as input files (since I use the same path variable) and will have a current date in the name, followed by <em>"_output"</em>. Number of columns and their names are specified in the last line and can be changed.</p>
                                  
                                  <div class="margin-top-40 margin-bottom-40">  
                                      <pre class="brush: python">
                                          with open(path + cur_date +'_output'+ '.csv', 'w', newline='') as csvfile:
                                          filewriter = csv.writer(csvfile, delimiter=',',
                                                                  quotechar='|', quoting=csv.QUOTE_MINIMAL)
                                          filewriter.writerow(['Sheet Name', 'Date', 'Cost', 'CountryId'])
                                     </pre>
                                    </div>
                                    <div class="post-title">
                                        <h2>Step 2 - iterating through sheets</h2> 
                                       </div>
                                     
                                  <p>Now the looping through countries is performed. The workbook is opened in read-only mode (it's faster if you have a very big workbook and it doesn't matter since we are only going to read from it anyway). In the variable sheets names of all the sheets in currently opened workbook are saved.</p>
                                  <p>This is a stage where these 3 sheets, mentioned earlier, that don’t contain any valuable data are excluded. This part can be excluded all together if you want to include data from all the sheets or replaced by some sort of filtering based on your specific conditions. In the given case these 3 sheets are filtered based on their name (you can change the names in brackets to any value you want to filter).</p>
                                  <div class="margin-top-40 margin-bottom-40">  
                                      <pre class="brush: python">
                                          for c_id, country in countries.items():
                                              #open the workbook
                                              started=datetime.datetime.now().strftime("%H:%M")
                                              wb = openpyxl.load_workbook(path + input_file + country + '.xlsx',read_only=True, data_only=True)

                                              sheets =  wb.sheetnames #list of sheet names

                                              #removing 3 sheets sheets - 2 very first sheets in the file and the last one 
                                              i=0
                                              while i <=1:
                                                  popped = sheets.pop(0)
                                                  i+=1
                                              sheets.pop()
                                     </pre>
                                    </div>
                                 
                                
                                
                                  <div class="post-title">
                                    <h2>Step 3 - extracting the data</h2> 
                                   </div>
                                   
                                   
                                   <p>So now we start iterating from all the sheets and create all the necessary variable we will use further.</p>
                                   
                                  
                                  

                                  
                                  
                                  
                                  <!-- Post Author Bio Box Start -->
                                  <div class="about-author margin-top-70 margin-bottom-50">
                                    
                                    <div class="picture">
                                      <img src="/images/blog/author.png" class="img-responsive" alt="">
                                     </div>
                                   
                                    <div class="c-padding">
                                       <h3>Article By <a href="#" target="_blank" data-toggle="tooltip" data-placement="top" title="Visit Alex Website">Alex Parker</a></h3>
                                       <p>You can use about author box when someone guest post on your blog, Lorem ipsum consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna ad minim veniam.</p>
                                      </div>
                                    </div>
                                    <!-- Post Author Bio Box End -->
                                    
                                    
                                    
                                    
                                  <!-- You May Also Like Start -->
                                  <div class="you-may-also-like margin-top-50 margin-bottom-50">
                                    <h3>You may also like</h3>
                                     <div class="row">
                                 
                                    <!--<div class="col-md-4 col-sm-6 col-xs-12">
                                      <a href="/single.html"><p>Make mailchimp singup form working with ajax using jquery plugin</p></a>
                                     </div>
                    
                                    <div class="col-md-4 col-sm-6 col-xs-12">
                                      <a href="/single.html"><p>How to design elegant e-mail newsletter in html for wish christmas to your subscribers?</p></a>
                                     </div>
                    
                                    <div class="col-md-4 col-sm-6 col-xs-12">
                                      <a href="/single.html"><p>How to customize a wordpress theme entirely from scratch using a child theme?</p></a>
                                     </div>
                                    
                                    </div>
                                  </div>
                                  <!-- You May Also Like End -->
                                    
                                   
                                  
                                  
                                  <!-- Post Comment (Disqus) Start -->
                                  <div id="comment" class="comment">
                                    <h3>Discuss about post</h3>
                                     
                                     
                                     <!-- Disqus Code Start  (Please Note: Disqus will not be load on local, You have to upload it on server.)-->
                                     <div id="disqus_thread"></div>
							          <script>
					
					/***  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS. LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables.
							
							var disqus_config = function () {
							this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
							this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
							};
							*/
							
							           (function() { // DON'T EDIT BELOW THIS LINE
							           var d = document, s = d.createElement('script');
							           s.src = '//uipasta.disqus.com/embed.js';   // Please change the url from your own disqus id
							           s.setAttribute('data-timestamp', +new Date());
							           (d.head || d.body).appendChild(s);
							           })();
							          </script>
			  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
              <!-- Disqus Code End -->
              
                                   </div>
                                   <!-- Post Comment (Disqus) End -->
                                  
                                   

                                </div>    
                             </div>
                              
                         </div>
                         
                        
                        
                          
                           
                         </div>
                     
                     
                       
                       <!-- Footer Start -->
                       <div class="col-md-12 page-body margin-top-50 footer">
                          <footer>
                          <ul class="menu-link">
                               <li><a href="/">Home</a></li>
                               <li><a href="/about.html">About</a></li>
                               <li><a href="/contact.html">Contact</a></li>
                            </ul>
                            
                          <p>© Copyright 2016 DevBlog. All rights reserved</p>
						  
						  
						  <!-- UiPasta Credit Start -->
                          <div class="uipasta-credit">Design By <a href="http://www.uipasta.com" target="_blank">UiPasta</a></div>
                          <!-- UiPasta Credit End -->
						  
                           
                         </footer>
                       </div>
                       <!-- Footer End -->
                     
                     
                  </div>
                  <!-- Blog Post (Right Sidebar) End -->
                
            </div>
         </div>
      </div>
    
    
    
     
     <!-- Endpage Box (Popup When Scroll Down) Start -->
     <div id="scroll-down-popup" class="endpage-box">
       <h4>Read Also</h4>
       <a href="#">How to make your company website based on bootstrap framework...</a>
      </div>
      <!-- Endpage Box (Popup When Scroll Down) End -->
      
    
    
    
    <!-- Back to Top Start -->
    <a href="#" class="scroll-to-top"><i class="fa fa-long-arrow-up"></i></a>
    <!-- Back to Top End -->
    
    
    <!-- All Javascript Plugins  -->
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script type="text/javascript" src="/js/plugin.js"></script>
    
    <!-- Main Javascript File  -->
    <script type="text/javascript" src="/js/scripts.js"></script>
    
    <!-- Syntax Highlighter Javascript File  -->
    <script type="text/javascript" src="/js/syntax/shCore.js"></script>
    <script type="text/javascript" src="/js/syntax/shBrushCss.js"></script>
    <script type="text/javascript" src="/js/syntax/shBrushJScript.js"></script>
    <script type="text/javascript" src="/js/syntax/shBrushPerl.js"></script>
    <script type="text/javascript" src="/js/syntax/shBrushPhp.js"></script>
    <script type="text/javascript" src="/js/syntax/shBrushPlain.js"></script>
    <script type="text/javascript" src="/js/syntax/shBrushPython.js"></script>
    <script type="text/javascript" src="/js/syntax/shBrushRuby.js"></script>
    <script type="text/javascript" src="/js/syntax/shBrushSql.js"></script>
    <script type="text/javascript" src="/js/syntax/shBrushVb.js"></script>
    <script type="text/javascript" src="/js/syntax/shBrushXml.js"></script>
    
	<!-- Syntax Highlighter Call Function -->
	<script type="text/javascript">
		SyntaxHighlighter.config.clipboardSwf = '/js/syntax/clipboard.swf';
		SyntaxHighlighter.all();
	</script>

    
   </body>
 </html>
